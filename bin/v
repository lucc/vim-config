#!/usr/bin/env -S nvim -S
" vim: ft=vim

function! s:all_readable(filelist)
  for l:file in a:filelist
    if !filereadable(l:file)
      return 0
    endif
  endfor
  return 1
endfunction

function! s:runTelescope(input)
  call v:lua.require'telescope.builtin'.oldfiles({"default_text": a:input})
endfunction

if argc() == 0
  " undeocumented function from fugitive
  let s:gitdir = FugitiveGitDir()
  if s:gitdir != ''
    " undeocumented behaviour from fugitive: open git status buffer
    execute "edit" s:gitdir . '/index'
  endif
elseif s:all_readable(argv()) " includes argc == 0
  " do nothing
else
  let s:args = join(argv(), '')
  %argdelete
  "%bwipeout
  call s:runTelescope(s:args)
endif
